<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="css/bootstrap.min.css" crossorigin="anonymous">

    <title>Hello, world!</title>
</head>
<body>
    <script src="js/lightstreamer.js"></script>
    <script>
        // http://www.lightstreamer.com/docs/client_javascript_tools/generator.html
        var myClient = new LightstreamerClient("http://localhost:9090", "WELCOME");
        myClient.connect();
        myClient.addListener({
            onListenStart: function(lsClient) {
                console.log("ON LISTEN START " + lsClient)
            },
            onStatusChange: function(newStatus) {
                console.log("STATUS: " + newStatus);
            },
            onServerError: function(i, errorMessage) {
                console.error("ERROR " + i + " " + errorMessage);
            },
            onPropertyChange: function(property) {
                console.log("PROPERTY " + property + "=" + myClient.connectionDetails[property] || myClient.connectionOptions[property]);
            },
            onListenEnd: function(lsClient) {
                console.log("ON LISTEN END " + lsClient);
            },
            onShareAbort: function(){
                console.log('Share Abort');
            }
        });

        console.log(myClient);

        var aapl = new Subscription("MERGE", "STOCK.AAPL", ["TIMESTAMP", "BID", "ASK", "ASK_SIZE", "BID_SIZE", "SEQ_NUM"]);
        aapl.setDataAdapter("STOCK");
        aapl.addListener({
            onItemUpdate: function (updateInfo) {
                let updates = '';
                updateInfo.forEachField(function (fieldName, fieldPos, value) {
                    updates +=  fieldName + ' = ' + value + '; ';
                });
                console.log(new Date() + ' ' + updates);
            },
            onSubscriptionError: function(code, message) {
                console.log('Error : ' + code + ' ' + message);
            },
            onEndOfSnapshot: function (itemName, itemPos) {
                console.log('onEndOfSnapshot ' + itemName);
            },
            onItemLostUpdates: function(itemName, itemPos, lostUpdates){
                console.log('onItemLostUpdates ' + itemName + ' ' + itemPos + ' ' + lostUpdates);
            }
        });

        myClient.subscribe(aapl);
    </script>

    <br>
    <div class="container">
        <div class="row">
            <div class="col-12">
                <table class="table">
                    <thead>
                    <tr>
                        <th scope="col">SYMBOL</th>
                        <th scope="col">SEQ_NUM</th>
                        <th scope="col">BID</th>
                        <th scope="col">BID SIZE</th>
                        <th scope="col">ASK</th>
                        <th scope="col">ASK_SIZE</th>
                        <th scope="col">LAST</th>
                        <th scope="col">TIMESTAMP</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <!--th><a href="#" data-toggle="modal" data-target="#exampleModal2">AAPL</a></th-->
                        <th>AAPL</th>
                        <td>1</td>
                        <td>$100.1</td>
                        <td>10000</td>
                        <td class="table-warning">$105.5</td>
                        <td>12000</td>
                        <td>$103</td>
                        <td>Feb 18, 2017</td>
                    </tr>
                    <tr>
                        <!--th><a href="#" data-toggle="modal" data-target="#exampleModal2">AAPL</a></th-->
                        <th>IBM</th>
                        <td>1</td>
                        <td>$100.1</td>
                        <td>10000</td>
                        <td class="table-warning">$105.5</td>
                        <td>12000</td>
                        <td>$103</td>
                        <td>Feb 18, 2017</td>
                    </tr>
                    </tbody>
                </table>

                <!--button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
                    Buy/sell stocks
                </button-->
            </div>

            <!--div class="col-4">
                <h2>Important notifications</h2>
                <div class="alert alert-warning" role="alert">
                    Buy 1000 AAPL shares - order sent
                </div>
                <div class="alert alert-success" role="alert">
                    Buy 100 AAPL shares - success
                </div>
                <div class="alert alert-warning" role="alert">
                    Sell 100 AAPL shares - order sent
                </div>
                <div class="alert alert-success" role="alert">
                    Sell 100 AAPL shares - success
                </div>
                <div class="alert alert-warning" role="alert">
                    Sell 1000 AAPL shares - order sent
                </div>
                <div class="alert alert-danger" role="alert">
                    Error - not enough stocks
                </div>
                <div class="alert alert-warning" role="alert">
                    Buy 1000 AAPL shares - order sent
                </div>
                <div class="alert alert-success" role="alert">
                    Buy 100 AAPL shares - success
                </div>
                <div class="alert alert-warning" role="alert">
                    Sell 100 AAPL shares - order sent
                </div>
                <div class="alert alert-success" role="alert">
                    Sell 100 AAPL shares - success
                </div>
                <div class="alert alert-warning" role="alert">
                    Sell 1000 AAPL shares - order sent
                </div>
                <div class="alert alert-danger" role="alert">
                    Error - not enough stocks
                </div>
            </div-->
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel2" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel2">AAPL</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <table class="table">
                        <tbody>
                            <tr>
                                <th>BID</th>
                                <td>$120.5</td>
                            </tr>
                            <tr>
                                <th>ASK</th>
                                <td class="table-warning"><b>$120.5</b></td>
                            </tr>
                            <tr>
                                <th>LAST trade price</th>
                                <td>$120.5</td>
                            </tr>
                            <tr>
                                <th>LAST trade amount</th>
                                <td>1000</td>
                            </tr>
                            <tr>
                                <th>Amount of market</th>
                                <td>120,000,000</td>
                            </tr>
                            <tr>
                                <th>Volatility</th>
                                <td>0.58</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Buy/sell stocks</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <input type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Symbol">
                        </div>
                        <div class="form-group">
                            <input type="password" class="form-control" id="exampleInputPassword1" placeholder="Quantity">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Buy</button>
                    <button type="button" class="btn btn-success" data-dismiss="modal">Sell</button>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="js/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
    <script src="js/popper.min.js" crossorigin="anonymous"></script>
    <script src="js/bootstrap.min.js" crossorigin="anonymous"></script>
</body>
</html>